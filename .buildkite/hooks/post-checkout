#!/bin/bash
set -euo pipefail

echo "--- :gear: Installing mise"
curl -sSf https://mise.run | sh
export PATH="$HOME/.local/bin:$PATH"

if command -v gh >/dev/null 2>&1; then
  if token="$(gh auth token 2>/dev/null)"; then
    export MISE_GITHUB_TOKEN="$token"
    if [[ -n "${BUILDKITE_ENV_FILE:-}" ]]; then
      printf 'export MISE_GITHUB_TOKEN=%q\n' "$token" >> "$BUILDKITE_ENV_FILE"
    fi
  fi
fi
